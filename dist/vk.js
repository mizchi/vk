// Generated by CoffeeScript 1.7.1
(function() {
  var VKNode, buildTags, vk;

  VKNode = (function() {
    function VKNode(tag, opts, text) {
      this.tag = tag;
      this.opts = opts;
      this.text = text;
      this.children = [];
    }

    VKNode.prototype.push = function(item) {
      return this.children.push(item);
    };

    return VKNode;

  })();

  vk = function() {
    return vk.compile.apply(vk, arguments);
  };

  vk.dom = function(component, opts, text) {
    var node;
    node = new VKNode(component, opts, text);
    console.log(node);
    return vk.ctx.push(node);
  };

  vk.ctx = null;

  buildTags = function() {
    var createTagFunc, isObject, parseOption, tags;
    tags = Object.keys(React.DOM);
    isObject = function(obj) {
      return (obj instanceof Object) && (Object.getPrototypeOf(obj) === Object.prototype);
    };
    parseOption = function(a1, a2) {
      var block, opts, text;
      opts = {};
      block = function() {};
      text = null;
      switch (arguments.length) {
        case 0:
          'pass';
          break;
        case 1:
          if (a1 instanceof Function) {
            block = a1;
          } else if ((typeof a1) === 'string') {
            text = a1;
          } else if (isObject(a1)) {
            opts = a1;
          }
          break;
        case 2:
          opts = a1;
          if (a2 instanceof Function) {
            block = a2;
          } else {
            text = a2;
          }
      }
      return {
        text: text,
        block: block,
        opts: opts
      };
    };
    createTagFunc = function(name) {
      return function() {
        var block, n, opts, orig, text, _ref;
        _ref = parseOption.apply(null, arguments), text = _ref.text, block = _ref.block, opts = _ref.opts;
        orig = vk.ctx;
        n = new VKNode(name, opts, text);
        vk.ctx.push(n);
        vk.ctx = n;
        block();
        return vk.ctx = orig;
      };
    };
    return tags.forEach(function(tag) {
      return vk.dom[tag] = createTagFunc(tag);
    });
  };

  buildTags();

  vk.render = function(block) {
    var root;
    if (block instanceof Function) {
      root = vk.ctx = new VKNode('div', {});
      block(vk.dom);
    } else if ((typeof block) === 'string') {
      root = vk.ctx = new VKNode('div', block);
    }
    return root;
  };

  vk.convert = function(_arg) {
    var children, component, opts, tag, text;
    tag = _arg.tag, opts = _arg.opts, children = _arg.children, text = _arg.text;
    component = tag instanceof Function ? tag : React.DOM[tag];
    if (text) {
      return component(opts, text);
    } else {
      return component(opts, children.map(function(child) {
        return vk.convert(child);
      }));
    }
  };

  vk.compile = function(opts, block) {
    var node, tag, _ref;
    if (arguments.length === 1) {
      block = opts;
      opts = {};
    }
    tag = (_ref = opts.tag) != null ? _ref : 'div';
    node = vk.render(block);
    node.opts = opts;
    node.tag = tag;
    return vk.convert(node);
  };

  window.vk = vk;

}).call(this);
